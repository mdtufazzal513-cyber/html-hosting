<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Super Admin</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        body { font-family: 'Inter', sans-serif; background: #1e293b; margin: 0; padding: 20px; color: #f8fafc; }
        
        #loginBox { max-width: 350px; margin: 100px auto; background: #334155; padding: 30px; border-radius: 12px; text-align: center; }
        input { width: 100%; padding: 12px; margin: 10px 0; border: none; border-radius: 6px; }
        button { width: 100%; padding: 12px; background: #3b82f6; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; }
        
        #dash { display: none; max-width: 1000px; margin: 0 auto; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 15px; margin-top: 20px; }
        .card { background: #334155; padding: 15px; border-radius: 8px; position: relative; border-left: 4px solid #3b82f6; }
        .card.deleted { opacity: 0.6; border-left-color: #ef4444; }
        .card.reported { border-left-color: #eab308; background: #451a03; }
        
        .btn-action { padding: 5px 10px; font-size: 12px; cursor: pointer; border: none; border-radius: 4px; margin-right: 5px; }
        .btn-del { background: #ef4444; color: white; }
        .btn-safe { background: #22c55e; color: white; }
    </style>
    
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
</head>
<body>

    <!-- Login -->
    <div id="loginBox">
        <h2>üõ°Ô∏è Admin Access</h2>
        <input type="email" id="admEmail" placeholder="Email">
        <input type="password" id="admPass" placeholder="Password">
        <button onclick="adminLogin()">Login</button>
        <p id="msg" style="color:red; margin-top:10px;"></p>
    </div>

    <!-- Dashboard -->
    <div id="dash">
        <div style="display:flex; justify-content:space-between; align-items:center; background:#0f172a; padding:15px; border-radius:8px;">
            <h3>Dashboard</h3>
            <button onclick="auth.signOut()" style="width:auto; background:#ef4444;">Logout</button>
        </div>
        
        <div class="grid" id="list">Loading...</div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyD-fR5yCte_c2pHpd0WD5IVjWmUvfUl5wA",
            authDomain: "html-code-hosting.firebaseapp.com",
            projectId: "html-code-hosting",
            storageBucket: "html-code-hosting.firebasestorage.app",
            messagingSenderId: "22191194064",
            appId: "1:22191194064:web:47fcd0b42f0f770ede43d5"
        };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        
        const ADMIN_UID = "wYswwC8YrvMItPT0qAwt9vkriey2";

        // Auth Listener
        auth.onAuthStateChanged(user => {
            if(user) {
                if(user.uid === ADMIN_UID) {
                    document.getElementById('loginBox').style.display = 'none';
                    document.getElementById('dash').style.display = 'block';
                    loadSites();
                } else {
                    document.getElementById('msg').innerText = "‚ùå Access Denied! Wrong UID.";
                    auth.signOut();
                }
            } else {
                document.getElementById('loginBox').style.display = 'block';
                document.getElementById('dash').style.display = 'none';
            }
        });

        function adminLogin() {
            const e = document.getElementById('admEmail').value;
            const p = document.getElementById('admPass').value;
            document.getElementById('msg').innerText = "Checking...";
            
            auth.signInWithEmailAndPassword(e, p).catch(err => {
                document.getElementById('msg').innerText = err.message;
            });
        }

        function loadSites() {
            db.collection('sites').orderBy('createdAt', 'desc').limit(50).onSnapshot(snap => {
                const list = document.getElementById('list');
                list.innerHTML = '';
                snap.forEach(doc => {
                    const d = doc.data();
                    const isRep = d.reportCount > 0;
                    const isDel = d.status === 'deleted';
                    
                    let cls = 'card';
                    if(isDel) cls += ' deleted';
                    else if(isRep) cls += ' reported';

                    list.innerHTML += `
                        <div class="${cls}">
                            <b>ID:</b> ${doc.id} <br>
                            <small>PIN: ${d.pin}</small><br>
                            <div style="margin:10px 0;">
                                <i class="fa-solid fa-eye"></i> ${d.views||0} | 
                                <i class="fa-solid fa-flag" style="color:${isRep?'orange':'inherit'}"></i> ${d.reportCount||0}
                            </div>
                            <button class="btn-action" style="background:#fff; color:#000" onclick="window.open('view.html?id=${doc.id}')">View</button>
                            ${!isDel ? `<button class="btn-action btn-del" onclick="act('${doc.id}', 'del')">Delete</button>` : ''}
                            ${isRep ? `<button class="btn-action btn-safe" onclick="act('${doc.id}', 'safe')">Safe</button>` : ''}
                        </div>
                    `;
                });
            });
        }

        function act(id, type) {
            if(!confirm("Are you sure?")) return;
            if(type === 'del') db.collection('sites').doc(id).update({status: 'deleted'});
            if(type === 'safe') db.collection('sites').doc(id).update({reportCount: 0});
        }
    </script>
</body>
</html>
